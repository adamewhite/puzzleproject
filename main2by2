var $ = function(id) { return document.getElementById(id) };

var randomNumber = function (min, max) {
	return Math.floor ( Math.random() * ( max - min + 1 ) + min );
}

var tileNumber = randomNumber (1,4);
var answerArray = [false, false, false, false];
var countdownTimer;
var seconds;
var gridsize = 0;
var playOrder = [];
var tileCorrespondent = 0;

var tileSetup = function () {

	if (document.getElementById("2x2").selected) {
		gridsize = 4;
	} else if (document.getElementById("2x3").selected) {
		gridsize = 6;
	} else if (document.getElementById("3x3").selected) {
		gridsize = 9;
	}

	var initialArray = [];

	var orderTile = function (length) {

		for (i = 1; i < length + 1; i++) {
			initialArray.push(i);
		}
		return;
	}

	orderTile(gridsize);

	if (document.getElementById("sequential").checked) {

		playOrder = initialArray;

		initialArray = ("tileNode" + initialArray.join('tileNode')).split(/(?=tileNode)/);

		for (var i = 0; i < initialArray.length; i++) {
			document.getElementById(initialArray[i]).src = "images/tile" + (i + 1) + ".png";
		}	

	} else {

		var shuffleTile = function (array) {
		    var i = array.length,
		        j = 0,
		        temp;

		    while (i--) {
		        j = Math.floor(Math.random() * (i+1));
		        temp = array[i];
		        array[i] = array[j];
		        array[j] = temp;
		    }
		    return initialArray;
		}

		shuffleTile(initialArray);

		var untiledShuffled = initialArray;

		console.log("untiled shuffled: " + untiledShuffled);

		// console.log("initial play order: " + playOrder);

		initialArray = ("tileNode" + initialArray.join('tileNode')).split(/(?=tileNode)/);

		for (var i = 0; i < initialArray.length; i++) {
			document.getElementById(initialArray[i]).src = "images/tile" + (i + 1) + ".png";

		}

		for (var i = 1; i < 5; i++) {

			playOrder.push(document.getElementById("tileNode" + i).src);

		}


		var x = playOrder[0].slice(-5)

		var y = x.charAt(0);

	}


	console.log("play order 0: " + playOrder[0]);
	console.log("removed character: " + x);
	console.log("char at: " + y);

	tileSwitch();

	}

var secondPassed = function() {
	var remainingSeconds = parseFloat(seconds / 10);

    document.getElementById('timer').innerHTML = remainingSeconds;

    if (seconds == 0) {
        clearInterval(countdownTimer);
        document.getElementById('timer').innerHTML = "";

        for (i = 0; i < answerArray.length; i++) {
			if (answerArray[i] == true) {
				gameWon = true;
			} else {
				gameWon = false;
				break;
			}
		} 

		if (gameWon) { 
			console.log("Winner!");
        } else {
        	gameOver();
        }

    } else {
        seconds--;
    }
}



var tileSwitch = function () {

	if (countdownTimer != null) {
		clearInterval(countdownTimer);
	}

	if (tileNumber) {
		document.getElementById("tileTemplate").src = "images/dogImage" + tileNumber + ".jpg";
	}

	document.getElementById("guess").focus();

	if (document.getElementById("slow").checked) {
		seconds = 90;
	} else if (document.getElementById("medium").checked) {
		seconds = 60;
	} else {
		seconds = 30;
	}

	countdownTimer = setInterval('secondPassed()', 100);
	
}

var gamePlay = function () {

	var submittedGuess = parseInt(document.getElementById("guess").value);

	if (submittedGuess == "") {
		document.getElementById("guess").focus();
	} else {
		if (isNaN(submittedGuess) || submittedGuess > 4) {
		document.getElementById("verify").firstChild.nodeValue = "Please enter a valid number.";
		document.getElementById("guess").value = "";
		document.getElementById("guess").focus();
		return;
	}
	}

	document.getElementById("verify").firstChild.nodeValue = "";

	var gameWon = false;

	console.log("initial array: " + playOrder)

	console.log("tile number: " + tileNumber)

	console.log("selected number: " + playOrder[tileNumber - 1]);

	if (submittedGuess != playOrder[tileNumber - 1]) {
		gameOver();
	}

	if (submittedGuess == playOrder[tileNumber - 1]) {
		answerArray[playOrder[tileNumber - 1] - 1] = true;

		for (i = 0; i < answerArray.length; i++) {
			if (answerArray[i] == true) {
				gameWon = true;
			} else {
				gameWon = false;
				break;
			}
		}

		if (gameWon) {		
			var tileArray = [];

			for ( var i = 1; i <= answerArray.length; i++) {
				tileArray.push("tileNode" + i);
			}

			for (var i = 0; i < tileArray.length; i++) {
				document.getElementById(tileArray[i]).src = "images/dogImage" + (i + 1) + ".jpg";
			}

			document.getElementById("tileTemplate").src = "images/youWon.png";
			document.getElementById("letsBegin").disabled = true;
			document.getElementById("guess").value = "";
			document.getElementById("guess").blur();
			seconds = 0;

		} else {

			do { 
				tileNumber = randomNumber(1,4);
			} while ( answerArray[tileNumber - 1] == true ) 


			console.log("answer array: " + answerArray);
			// console.log("tile number: " + tileNumber);

			document.getElementById("guess").value = "";
			document.getElementById("guess").focus();
			tileSwitch();
		}
	}
}

var gameOver = function () {
	document.getElementById("tileTemplate").src = "images/gameOver.png";
	document.getElementById("guess").value = "";	
	document.getElementById("verify").firstChild.nodeValue = "";	
	document.getElementById("guess").blur();	
	document.getElementById("letsBegin").disabled = true;	
	seconds = 0;
}

var initializeGame = function () {
	document.getElementById("tileNode1").src = "images/tile1.png";
	document.getElementById("tileNode2").src = "images/tile2.png";
	document.getElementById("tileNode3").src = "images/tile3.png";
	document.getElementById("tileNode4").src = "images/tile4.png";
	document.getElementById("tileTemplate").src = "images/tileBlank.png";
	document.getElementById("letsBegin").disabled = false;
	document.getElementById("guess").blur();
	document.getElementById("verify").firstChild.nodeValue = "";
	answerArray = [false, false, false, false];
	clearInterval(countdownTimer);
	gameWon = false;
}



window.onload = function () {
	$("letsBegin").onclick = tileSetup;
	$("guess").onkeyup = gamePlay;
	$("resetGame").onclick = initializeGame;
}
