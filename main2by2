var $ = function(id) { return document.getElementById(id) };

var randomNumber = function (min, max) {
	return Math.floor ( Math.random() * ( max - min + 1 ) + min );
}

var tileNumber = randomNumber (1,4);
var answerArray = [false, false, false, false];
var countdownTimer;
var seconds;

var secondPassed = function() {
	var remainingSeconds = parseFloat(seconds / 10);

	console.log(seconds);

    document.getElementById('timer').innerHTML = remainingSeconds;

    if (seconds == 0) {
        clearInterval(countdownTimer);
        document.getElementById('timer').innerHTML = "";

        for (i = 0; i < answerArray.length; i++) {
			if (answerArray[i] == true) {
				gameWon = true;
			} else {
				gameWon = false;
				break;
			}
		} 

		if (gameWon) { 
			console.log("Winner!");
        } else {
        	gameOver();
        }

    } else {
        seconds--;
    }
}



var tileSwitch = function () {

	if (countdownTimer != null) {
		clearInterval(countdownTimer);
	}

	if (tileNumber) {
		document.getElementById("tileTemplate").src = "images/dogImage" + tileNumber + ".jpg";
	}

	document.getElementById("guess").focus();

	if (document.getElementById("slow").checked) {
		seconds = 90;
	} else if (document.getElementById("medium").checked) {
		seconds = 60;
	} else {
		seconds = 30;
	}

	countdownTimer = setInterval('secondPassed()', 100);
	
}

var gamePlay = function () {

	var submittedGuess = parseInt(document.getElementById("guess").value);

	if (submittedGuess == "") {
		document.getElementById("guess").focus();
	} else {
		if (isNaN(submittedGuess) || submittedGuess > 4) {
		document.getElementById("verify").firstChild.nodeValue = "Please enter a valid number.";
		document.getElementById("guess").value = "";
		document.getElementById("guess").focus();
		return;
	}
	}

	document.getElementById("verify").firstChild.nodeValue = "";

	var gameWon = false;

	if (submittedGuess != tileNumber) {
		gameOver();
	}

	if (submittedGuess == tileNumber) {
		answerArray[tileNumber - 1] = true;

		for (i = 0; i < answerArray.length; i++) {
			if (answerArray[i] == true) {
				gameWon = true;
			} else {
				gameWon = false;
				break;
			}
		}

		if (gameWon) {		
			var tileArray = [];

			for ( var i = 1; i <= answerArray.length; i++) {
				tileArray.push("tile" + i);
			}

			for (var i = 0; i < tileArray.length; i++) {
				document.getElementById(tileArray[i]).src = "images/dogImage" + (i + 1) + ".jpg";
			}

			document.getElementById("tileTemplate").src = "images/youWon.jpg";
			document.getElementById("letsBegin").disabled = true;
			document.getElementById("guess").value = "";
			document.getElementById("guess").blur();
			seconds = 0;

		} else {

			do { 
				tileNumber = randomNumber(1,4);
			} while ( answerArray[tileNumber - 1] == true ) 

			document.getElementById("guess").value = "";
			document.getElementById("guess").focus();
			tileSwitch();
		}
	}
}

var gameOver = function () {
	document.getElementById("tileTemplate").src = "images/gameOver.jpg";
	document.getElementById("guess").value = "";	
	document.getElementById("verify").firstChild.nodeValue = "";	
	document.getElementById("guess").blur();	
	document.getElementById("letsBegin").disabled = true;	
	seconds = 0;
}

var initializeGame = function () {
	document.getElementById("tile1").src = "images/tile1.jpg";
	document.getElementById("tile2").src = "images/tile2.jpg";
	document.getElementById("tile3").src = "images/tile3.jpg";
	document.getElementById("tile4").src = "images/tile4.jpg";
	document.getElementById("tileTemplate").src = "images/tileTemplate.jpg";
	document.getElementById("letsBegin").disabled = false;
	document.getElementById("guess").blur();
	document.getElementById("verify").firstChild.nodeValue = "";
	answerArray = [false, false, false, false];
	clearInterval(countdownTimer);
	gameWon = false;
}



window.onload = function () {
	$("letsBegin").onclick = tileSwitch;
	$("guess").onkeyup = gamePlay;
	$("resetGame").onclick = initializeGame;
}
